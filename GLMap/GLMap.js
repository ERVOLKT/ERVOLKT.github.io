!function(a){function b(a,b,c){return Math.min(c,Math.max(a,b))}function c(a){a.preventDefault&&a.preventDefault(),a.stopPropagation&&a.stopPropagation(),a.returnValue=!1}var d=a.document,e=function(a,b){this.container="string"==typeof a?d.getElementById(a):a,b=b||{},this.container.classList.add("glmap-container"),this.width=this.container.offsetWidth,this.height=this.container.offsetHeight,this.minZoom=parseFloat(b.minZoom)||10,this.maxZoom=parseFloat(b.maxZoom)||20,this.maxZoom<this.minZoom&&(this.maxZoom=this.minZoom),this.bounds=b.bounds,this.center={x:0,y:0},this.zoom=0,this.listeners={},this.restoreState(b),b.state&&(this.persistState(),this.on("change",function(){this.persistState()}.bind(this))),this.interaction=new f(this,this.container),this.layers=new g(this),b.disabled&&this.setDisabled(!0),this.attribution=b.attribution,this.attributionDiv=d.createElement("DIV"),this.attributionDiv.className="glmap-attribution",this.container.appendChild(this.attributionDiv),this.updateAttribution()};e.TILE_SIZE=256,e.prototype={updateAttribution:function(){var a=this.layers.getAttribution();this.attribution&&a.unshift(this.attribution),this.attributionDiv.innerHTML=a.join(" Â· ")},restoreState:function(a){var b=location.search,c={};b&&b.substring(1).replace(/(?:^|&)([^&=]*)=?([^&]*)/g,function(a,b,d){b&&(c[b]=d)});var d;void 0!==c.lat&&void 0!==c.lon&&(d={latitude:parseFloat(c.lat),longitude:parseFloat(c.lon)}),this.setPosition(d||a.position||{latitude:52.52,longitude:13.41});var e;void 0!==c.zoom&&(e=void 0!==c.zoom?parseFloat(c.zoom):null),this.setZoom(e||a.zoom||this.minZoom);var f;void 0!==c.rotation&&(f=parseFloat(c.rotation)),this.setRotation(f||a.rotation||0);var g;void 0!==c.tilt&&(g=parseFloat(c.tilt)),this.setTilt(g||a.tilt||0);var h;void 0!==c.bend&&(h=parseFloat(c.bend)),this.setBend(h||a.bend||0)},persistState:function(){history.replaceState&&(this.stateDebounce||(this.stateDebounce=setTimeout(function(){this.stateDebounce=null;var a=[];a.push("lat="+this.position.latitude.toFixed(5)),a.push("lon="+this.position.longitude.toFixed(5)),a.push("zoom="+this.zoom.toFixed(1)),a.push("tilt="+this.tilt.toFixed(1)),a.push("bend="+this.bend.toFixed(1)),a.push("rotation="+this.rotation.toFixed(1)),history.replaceState({},"","?"+a.join("&"))}.bind(this),1e3)))},setCenter:function(a){var c=e.TILE_SIZE*Math.pow(2,this.zoom);if(this.bounds){var d=this.project(this.bounds.s,this.bounds.w,c),f=this.project(this.bounds.n,this.bounds.e,c);a.x=b(a.x,d.x,f.x),a.y=b(a.y,d.y,f.y)}(this.center.x!==a.x||this.center.y!==a.y)&&(this.center=a,this.position=this.unproject(a.x,a.y,c),this.emit("change"))},emit:function(a,b){if(this.listeners[a]){var c=this.listeners[a];requestAnimationFrame(function(){for(var a=0,d=c.length;d>a;a++)c[a](b)})}},on:function(a,b){return this.listeners[a]||(this.listeners[a]=[]),this.listeners[a].push(b),this},off:function(a,b){if(this.listeners[a])for(var c=this.listeners[a],d=0;d<c.length;d++)if(c[d]===b)return void c.splice(d,1)},setDisabled:function(a){return this.interaction.disabled=!!a,this},isDisabled:function(){return!!this.interaction.disabled},project:function(a,b,c){var d=b/360+.5,e=Math.min(1,Math.max(0,.5-Math.log(Math.tan(Math.PI/4+Math.PI/2*a/180))/Math.PI/2));return{x:d*c,y:e*c}},unproject:function(a,b,c){return a/=c,b/=c,{latitude:(2*Math.atan(Math.exp(Math.PI*(1-2*b)))-Math.PI/2)*(180/Math.PI),longitude:360*a-180}},getBounds:function(){var a=this.width/2,b=this.height/2,c=this.rotation*Math.PI/180,d=Math.cos(c)*a-Math.sin(c)*b,f=Math.sin(c)*a+Math.cos(c)*b,g=this.center,h=e.TILE_SIZE*Math.pow(2,this.zoom),i=this.unproject(g.x-d,g.y-f,h),j=this.unproject(g.x+d,g.y+f,h);return{n:i.latitude,w:i.longitude,s:j.latitude,e:j.longitude}},setZoom:function(a,c){if(a=b(parseFloat(a),this.minZoom,this.maxZoom),this.zoom!==a){var d=Math.pow(2,a-this.zoom);if(this.zoom=a,c){var e=this.container.offsetWidth/2-c.clientX,f=this.container.offsetHeight/2-c.clientY;this.center.x-=e,this.center.y-=f,this.center.x*=d,this.center.y*=d,this.center.x+=e,this.center.y+=f}else this.center.x*=d,this.center.y*=d;this.emit("change")}return this},getZoom:function(){return this.zoom},setPosition:function(a){var c=b(parseFloat(a.latitude),-90,90),d=b(parseFloat(a.longitude),-180,180),f=this.project(c,d,e.TILE_SIZE*Math.pow(2,this.zoom));return this.setCenter(f),this},getPosition:function(){return this.position},setSize:function(a){return(a.width!==this.width||a.height!==this.height)&&(this.width=a.width,this.height=a.height,this.emit("resize")),this},getSize:function(){return{width:this.width,height:this.height}},setRotation:function(a){return a=parseFloat(a)%360,this.rotation!==a&&(this.rotation=a,this.emit("change")),this},getRotation:function(){return this.rotation},setTilt:function(a){return a=b(parseFloat(a),0,60),this.tilt!==a&&(this.tilt=a,this.emit("change")),this},getTilt:function(){return this.tilt},setBend:function(a){return a=b(parseFloat(a),0,90),this.bend!==a&&(this.bend=a,this.emit("change")),this},getBend:function(){return this.bend},addLayer:function(a){return this.layers.add(a),this.updateAttribution(),this},removeLayer:function(a){this.layers.remove(a),this.updateAttribution()},destroy:function(){this.listeners=null,this.interaction.destroy(),this.layers.destroy()}},"function"==typeof a.define?a.define([],e):"object"==typeof a.exports?a.module.exports=e:a.GLMap=e;var f=function(b,c){this.map=b,"ontouchstart"in a?(this._addListener(c,"touchstart",this.onTouchStart),this._addListener(d,"touchmove",this.onTouchMove),this._addListener(d,"touchend",this.onTouchEnd),this._addListener(c,"gesturechange",this.onGestureChange)):(this._addListener(c,"mousedown",this.onMouseDown),this._addListener(d,"mousemove",this.onMouseMove),this._addListener(d,"mouseup",this.onMouseUp),this._addListener(c,"dblclick",this.onDoubleClick),this._addListener(c,"mousewheel",this.onMouseWheel),this._addListener(c,"DOMMouseScroll",this.onMouseWheel));var e;this._addListener(a,"resize",function(){e||(e=setTimeout(function(){e=null,b.setSize({width:c.offsetWidth,height:c.offsetHeight})},250))})};f.prototype={prevX:0,prevY:0,startX:0,startY:0,startZoom:0,prevRotation:0,prevTilt:0,disabled:!1,pointerIsDown:!1,_listeners:[],_addListener:function(a,b,c){var d=c.bind(this);a.addEventListener(b,d,!1),this._listeners.push({target:a,type:b,fn:d})},onDoubleClick:function(a){this.disabled||(c(a),this.map.setZoom(this.map.zoom+1,a))},onMouseDown:function(a){this.disabled||a.button>1||(c(a),this.startZoom=this.map.zoom,this.prevRotation=this.map.rotation,this.prevTilt=this.map.tilt,this.startX=this.prevX=a.clientX,this.startY=this.prevY=a.clientY,this.pointerIsDown=!0,this.map.emit("pointerdown",{x:a.clientX,y:a.clientY}))},onMouseMove:function(a){this.disabled||(this.pointerIsDown&&(0!==a.button||a.altKey?this.rotateMap(a):this.moveMap(a),this.prevX=a.clientX,this.prevY=a.clientY),this.map.emit("pointermove",{x:a.clientX,y:a.clientY}))},onMouseUp:function(a){this.disabled||this.pointerIsDown&&(0!==a.button||a.altKey?this.rotateMap(a):(Math.abs(a.clientX-this.startX)>5||Math.abs(a.clientY-this.startY)>5)&&this.moveMap(a),this.pointerIsDown=!1,this.map.emit("pointerup",{x:a.clientX,y:a.clientY}))},onMouseWheel:function(a){if(!this.disabled){c(a);var b=0;a.wheelDeltaY?b=a.wheelDeltaY:a.wheelDelta?b=a.wheelDelta:a.detail&&(b=-a.detail);var d=.2*(b>0?1:0>b?-1:0);this.map.setZoom(this.map.zoom+d,a)}},moveMap:function(a){var b=a.clientX-this.prevX,c=a.clientY-this.prevY,d=this.map.rotation*Math.PI/180,e={x:Math.cos(d)*b-Math.sin(d)*c,y:Math.sin(d)*b+Math.cos(d)*c};this.map.setCenter({x:this.map.center.x-e.x,y:this.map.center.y-e.y})},rotateMap:function(a){this.prevRotation+=(a.clientX-this.prevX)*(360/innerWidth),this.prevTilt-=(a.clientY-this.prevY)*(360/innerHeight),this.map.setRotation(this.prevRotation),this.map.setTilt(this.prevTilt)},onTouchStart:function(a){this.disabled||(c(a),this.startZoom=this.map.zoom,this.prevRotation=this.map.rotation,this.prevTilt=this.map.tilt,a.touches.length&&(a=a.touches[0]),this.startX=this.prevX=a.clientX,this.startY=this.prevY=a.clientY,this.map.emit("pointerdown",{x:a.clientX,y:a.clientY}))},onTouchMove:function(a){this.disabled||(a.touches.length&&(a=a.touches[0]),this.moveMap(a),this.prevX=a.clientX,this.prevY=a.clientY,this.map.emit("pointermove",{x:a.clientX,y:a.clientY}))},onTouchEnd:function(a){this.disabled||(a.touches.length&&(a=a.touches[0]),(Math.abs(a.clientX-this.startX)>5||Math.abs(a.clientY-this.startY)>5)&&this.moveMap(a),this.map.emit("pointerup",{x:a.clientX,y:a.clientY}))},onGestureChange:function(a){this.disabled||(c(a),this.map.setZoom(this.startZoom+(a.scale-1)),this.map.setRotation(this.prevRotation-a.rotation))},destroy:function(){this.disabled=!0;for(var a,b=0;b<this._listeners.length;b++)a=this._listeners[b],a.target.removeEventListener(a.type,a.fn,!1)}};var g=function(a){this.map=a,this.items=[]};g.prototype={add:function(a){this.items.push(a)},remove:function(a){for(var b=0;b<this.items.length;b++)if(this.items[b]===a)return void this.items.splice(b,1)},getAttribution:function(){for(var a=[],b=0;b<this.items.length;b++)this.items[b].attribution&&a.push(this.items[b].attribution);return a},destroy:function(){for(var a=0;a<this.items.length;a++)this.items[a].destroy();this.items=null}}}(this);