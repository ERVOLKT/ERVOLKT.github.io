<!DOCTYPE html>
<html>
  <head>
    <title>BUGA osmb</title>
      <meta charset="utf-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    
   
    <link rel="stylesheet" href="css/bootstrap.min.css">
    <link rel="stylesheet" href="css/bootstrap-theme.min.css">
    <link rel="stylesheet" href="GLMap/GLMap.css"/>
    
    <script src="jquery/jquery-2.1.1.min.js"></script>
    <script src="js/bootstrap.min.js"></script>
    <script src="OpenLayers-2.13.1/OpenLayers.js"></script> 
    <script src="OSMBuildings-OpenLayers.debug.js"></script>
    <script src="GLMap/GLMap.debug.js"></script>   
    <script src="OSMBuildings/OSMBuildings-GLMap.debug.js"></script>
    <!-- Additional GeoJSON Data -->
    <script src="bugabuildings.js"></script>
       
    <style>
     
    .btn-round {
    width: 40px;
    height: 40px;
    border-radius: 50%;
    }

    .btn-round.btn-sm {
    width: 34px;
    height: 34px;
    }


     #glmap {
  /*    width: 100%;     */      
      height: 500px;
 /*     position:absolute;
      left:10%;
      float:left;*/
    }
    
    /*Achte hierauf sonst könnte die olmap nicht sichtbar sein!*/
    #olmap {
 /*     width: 100%;      */     
      height: 500px;
  /*    position:absolute;
      left: 10%;
      float:left;   */
    }
    
    .olControlAttribution {
        bottom: 5px !important;
        font-size: 11px;
      } 

    .olControlLayerSwitcher {
      top: 5px !important;
    }
    .jumbotron {
    padding-bottom: 8px;
    }
    </style>
   
    <script type="text/javascript">
/* wo sind jetzt die Controls ? Kann der User übraupt interagieren? und auf Mobile?
 Müssen die Divs andere Klassen haben?
 
 */

var buildingstyle = {roofColor: 'rgba(204, 102, 0, 0.6)', color: 'rgb(190,158,150)'};
var controlButtons = document.querySelectorAll('.control button');

function glhide(){
  $("#olmap").show();
  $("#glmap").hide();
}

function glshow(){
  $("#glmap").show();
  $("#olmap").hide();
}
   

$( document ).ready(function() {
    
   //++++2.5D
 olmap = new OpenLayers.Map('olmap'
    , 
            {eventListeners: {
                move: function(e) {
                threedz = olmap.getZoom();
                threedxy = olmap.getCenter();
                
                 if (threedz > 16){
                     console.log("zoom ist "+threedz);
    //            dswitch('turnon', threedz, threedxy);      
                }
                
                }
            }
            }
            );
      olmap.addControl(new OpenLayers.Control.LayerSwitcher());
   
      olmap.addLayer(new OpenLayers.Layer.OSM("Mapbox_outdoors_volker",
       ['https://a.tiles.mapbox.com/v3/volker6457.no773m04/${z}/${x}/${y}.png',
       'https://b.tiles.mapbox.com/v3/volker6457.no773m04/${z}/${x}/${y}.png',
       'https://c.tiles.mapbox.com/v3/volker6457.no773m04/${z}/${x}/${y}.png'
       ]
      ));

    olmap.setCenter(
      new OpenLayers.LonLat(9.209123253822327, 49.14630295624662)
      .transform(
        new OpenLayers.Projection('EPSG:4326'),
        olmap.getProjectionObject()
      ), 16);
// Das OSMBuildings-Objekt musste umbenannt werden, siehe auch in der osmb-ol-debug-Datei!      
    olosmb = new olOSMBuildings(olmap).load();
     olosmb.style(buildingstyle);
     
    //++++3D

// Hierüber werden die Controls aktiviert(?) 

for (var i = 0; i < controlButtons.length; i++) {
  controlButtons[i].addEventListener('click', function(e) {
    var button = this;
    var parentClassList = button.parentNode.classList;
    var direction = button.classList.contains('inc') ? 1 : -1;
    var increment;
    var property;

    if (parentClassList.contains('tilt')) {
      property = 'Tilt';
      increment = direction*10;
    }
    if (parentClassList.contains('rotation')) {
      property = 'Rotation';
      increment = direction*10;
    }
    if (parentClassList.contains('zoom')) {
      property = 'Zoom';
      increment = direction*1;
    }
     
    if (parentClassList.contains('bend')) {
      property = 'Bend';
      increment = direction*5;
    }
    if (property) {
      glmap['set'+ property](glmap['get'+ property]()+increment);
    }
    
  });
}
    $(".glhide").click(function(){
         glhide();
        });
        
    $(".glshow").click(function(){
        glshow();
        });



   glmap = new GLMap('glmap', {
    position: { latitude:49.14740, longitude:9.20392 },
    zoom: 15,
    rotation: 340,
    tilt: 40,
    bend: 20,  //???
    // disabled: true, // disables user input
    minZoom: 11,
    maxZoom: 22,
    state: true // stores map position/rotation in url
  });

    glosmb = new OSMBuildings({
    minZoom: 12,
    maxZoom: 22,
    // showBackfaces: true, // render front and backsides of polygons. false increases performance, true might be needed for bad geometries
    attribution: '© 3D <a href="http://osmbuildings.org/copyright/">OSM Buildings</a>'
  }).addTo(glmap);
  
    glosmb.setStyle(buildingstyle);
    //historic maptiles-method:
    /*
    osmb.addTileLayer('http://{s}.tiles.mapbox.com/v3/osmbuildings.kbpalbpk/{z}/{x}/{y}.png');
    */
    glosmb.addMapTiles(
 //   'http://{s}.tiles.mapbox.com/v3/osmbuildings.kbpalbpk/{z}/{x}/{y}.png',
    'https://{s}.tiles.mapbox.com/v3/volker6457.no773m04/{z}/{x}/{y}.png',
    {
      attribution: '© Data <a href="http://openstreetmap.org/copyright/">OpenStreetMap</a> · © Map <a href="http://mapbox.com">MapBox</a>'
    }
  );
  
   glosmb.addGeoJSONTiles(
    'http://{s}.data.osmbuildings.org/0.2/anonymous/tile/{z}/{x}/{y}.json',
    {
  //     buffer: 0, // how many tiles to preload around visible area - not working yet
    });
    
    //ruft  events-Fehler bei OL auf, ist aber für highlighting praktisch, und evtl. später für Popup-Position und POpup-Inhalte:
  glmap.on('pointermove', function(e) {
    var id = glosmb.getTarget(e.x, e.y);
    if (id) {
    //    console.log(id);
      document.body.style.cursor = 'pointer';
      glosmb.highlight(id, '#BDE693');
    } else {
      document.body.style.cursor = 'default';
      glosmb.highlight(null);
    }
  });


obj = glosmb.addGeoJSON('geojson/esplanade.geojson', { 
    "color": 'rgb(243,194,80)'
    }
    );
                                       
obj = glosmb.addGeoJSON('geojson/insel.geojson', {
    "color": 'rgb(188,230,73)'
} );

obj = glosmb.addGeoJSON('geojson/neckar.geojson', {
    //if (obj.item.id ===  "way/-705") {    //filter this way (?)
    "color": 'rgb(204,221,221)'
} );
/*
obj = osmb.addGeoJSON('geojson/BUGA.geojson', {
    "color": 'rgba(88,130,173, 0.5)'
} );


obj = osmb.addGeoJSON('geojson/water.geojson', {} );
obj.color = {
              r:13,
              g:7,
              b:73
            };

obj = osmb.addGeoJSON('geojson/grass.geojson', {} );
obj.color = {
              r:184,
              g:211,
              b:143
            };
            
obj = osmb.addGeoJSON('geojson/weinberge.geojson', {} );
obj.color = {
              r:174,
              g:255,
              b:133
            };            
*/
  //adapted from   https://developer.mozilla.org/en-US/Learn/WebGL/By_example/Detect_WebGL
     (function detectWebGLContext () {
   
    var canvas = document.createElement("canvas");
    // Get WebGLRenderingContext from canvas element.
    var gl = canvas.getContext("webgl")
      || canvas.getContext("experimental-webgl");
    // Report the result.
    if (gl && gl instanceof WebGLRenderingContext) {
      console.log("Browser supports WebGL.");
    } else {
      console.log("Failed to get WebGL context. "
        + "Browser or device may not support WebGL.");
    }
  })();
  

  

});
    
    </script> 


  </head>
  
  <body>
    <div class="navbar navbar-inverse navbar-fixed-top" role="navigation">
      <div class="container-fluid">
        <div class="navbar-header">
          <button type="button" class="navbar-toggle" data-toggle="collapse" data-target=".navbar-collapse">
            <span class="sr-only">Toggle navigation</span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
            <span class="icon-bar"></span>
          </button>
          <a class="navbar-brand" href="#">BUGABUILDINGS</a>
        </div>
        <div class="navbar-collapse collapse">
          <ul class="nav navbar-nav">
            <li class="active glshow"><a href="#3dmap" data-toggle="tab">Übersicht</a></li>
            <li class="glhide" ><a href="#2dmap" data-toggle="tab">2D Map</a></li>
            <li><a href="#Neckar">Neckarschenkel</a></li>
            <li><a href="#Esplanade">Esplanade</a></li>
            <li><a href="#Insel">Inselschenkel</a></li>
            <li class="dropdown">
              <a href="#" class="dropdown-toggle" data-toggle="dropdown">Etc <b class="caret"></b></a>
              <ul class="dropdown-menu">
                <li><a href="#">Action</a></li>
                <li><a href="#">Another action</a></li>
                <li><a href="#">Something else here</a></li>
                <li class="divider"></li>
                <li class="dropdown-header">Nav header</li>
                <li><a href="#">Separated link</a></li>
                <li><a href="#">One more separated link</a></li>
              </ul>
            </li>
          </ul>
        </div><!--/.nav-collapse -->
      </div>
    </div>

    <div class="container theme-showcase">
      <!-- Main jumbotron for a primary marketing message or call to action -->
      <div class="jumbotron">
        <h3>Hello, world!</h3>
        <p>This is my webdev playground for the visualisation of the BUGA Heilbronn. It uses  mainly OSMBuildings code. </p>
        <p><a href="#" class="btn btn-primary btn-sm" role="button">OK &raquo;</a></p>
      </div>
      
      <div class="page-header">
        <h1>Feel free to click these buttons</h1>
      </div>
      <div class="row">
        <div class="col-xs-3">sample-text sample-text sample-text sample-text sample-text sample-text sample-text sample-text sample-text sample-text sample-text sample-text sample-text sample-text sample-text sample-text sample-textsample-textsample-textsample-text sample-textsample-text sample-text sample-textsample-textsample-text sample-text sample-textsample-textsample-textsample-textsample-textsample-textsample-textsample-textsample-textsample-textsample-text</div>
        <div id='glmap'class="col-xs-7"></div>
        <div id='olmap'class="col-xs-7"></div>
        <div class="col-xs-1">
          <button type="button" class="btn btn-round btn-sm btn-warning glhide"  >2d</button>
          <button type="button" class="btn btn-round btn-sm btn-success glshow" >3d</button>
        </div>
      </div>
    </div> <!-- /container -->
  </body>
</html>
